# install Vosk models
mkdir models
models="vosk-model-el-gr-0.7
vosk-model-small-ca-0.4
vosk-model-small-cn-0.22
vosk-model-small-cs-0.4-rhasspy
vosk-model-small-de-0.15
vosk-model-small-en-us-0.15
vosk-model-small-eo-0.42
vosk-model-small-es-0.42
vosk-model-small-fa-0.5
vosk-model-small-fr-0.22
vosk-model-small-hi-0.22
vosk-model-small-it-0.22
vosk-model-small-ja-0.22
vosk-model-small-ko-0.22
vosk-model-small-nl-0.22
vosk-model-small-pl-0.22
vosk-model-small-pt-0.3
vosk-model-small-ru-0.22
vosk-model-small-sv-rhasspy-0.15
vosk-model-small-tr-0.3
vosk-model-small-uk-v3-small
vosk-model-small-vn-0.4"
for model in models; do
    curl -sLfo models/$model.zip https://alphacephei.com/vosk/models/$model.zip
    unzip models/$model.zip -d models
done

# install glow-speak
script=glowspeak.sh
link="/usr/local/bin/glowspeak"
voices="cmn_jing_li nl_rdh en-us_mary_ann en-us_ljspeech fi_harri_tapani_ylilammi fr_siwis de_thorsten el_rapunzelina hu_diana_majlinger it_riccardo_fasol ko_kss ru_nikolaev es_tux sw_biblia_takatifu sv_talesyntese vi_vais1000"
git clone https://github.com/rhasspy/glow-speak.git
cd glow-speak/
python3 -m venv .venv
source .venv/bin/activate
pip3 install --upgrade pip
pip3 install --upgrade setuptools wheel
pip3 install -f 'https://synesthesiam.github.io/prebuilt-apps/' -r requirements.txt
python3 setup.py develop
for voice in voices; do
    glow-speak-download $voice
done
deactivate
echo '#!/bin/bash
if [ -z "$1" -o -z "$2" ]; then
    echo "Usage: glowspeak <voice> <text>"
    exit
fi
voice=$1
shift
source '$(pwd)'/.venv/bin/activate
echo "$@"|glow-speak -v $voice --output-file -
deactivate
' > $script
chmod 755 $script
sudo ln -s $(pwd)/$script $link

# install LibreTranslate
pip install libretranslate
libretranslate
# TODO:
# - create a service script to start the server at boot time
# - configure the listening port

